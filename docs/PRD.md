# 天気予報アプリ PRD

## 概要

OpenWeatherMap APIを使用した天気予報アプリ。4つの地域（東京、兵庫、大分、北海道）の5日間天気予報を表示する。

---

## 関連ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| [requirements.md](./requirements.md) | 機能要件・受け入れ条件（Gherkin記法） |
| [DESIGN.md](./DESIGN.md) | アーキテクチャ・コンポーネント設計・型定義 |
| [TASKS.md](./TASKS.md) | 開発タスクリスト・TDDの進め方 |

---

## 技術スタック

| 領域 | 採用技術 | 選定理由 |
|------|----------|----------|
| ビルド | Vite | 高速、設定シンプル |
| UI | React 18 + TypeScript | 要件指定 |
| データ取得 | TanStack Query v5 | キャッシュ要件との相性、宣言的な状態管理 |
| ルーティング | React Router v6 | SPA標準、軽量 |
| スタイリング | Tailwind CSS v3 | 開発速度、経験あり |
| テスト | Vitest + Testing Library | Viteとの統合、React標準 |
| APIモック | MSW (Mock Service Worker) | TDDでのAPI層テストに必要 |

---

## API仕様

### エンドポイント

```
GET https://api.openweathermap.org/data/2.5/forecast
```

### リクエストパラメータ

| パラメータ | 値 |
|------------|-----|
| q | Tokyo / Hyogo / Oita / Hokkaido |
| units | metric（固定） |
| lang | ja（固定） |
| APPID | 発行したAPIキー |

### 使用するレスポンスフィールド

```typescript
{
  list: [
    {
      dt: number;           // Unix timestamp
      main: {
        temp: number;       // 気温（℃）
      };
      weather: [
        {
          icon: string;     // アイコンコード（例: "01d"）
        }
      ];
    }
  ]
}
```

### アイコンURL

```
https://openweathermap.org/img/wn/{icon}@2x.png
```

---

## 画面設計

### ホーム画面

```
┌─────────────────────────────┐
│  天気予報アプリ              │
├─────────────────────────────┤
│  ┌─────────────────────┐   │
│  │ 🗾 東京              → │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 🗾 兵庫              → │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 🗾 大分              → │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 🗾 北海道            → │   │
│  └─────────────────────┘   │
└─────────────────────────────┘
```

### 天気画面

```
┌─────────────────────────────┐
│  ← 戻る    東京の天気        │
├─────────────────────────────┤
│  ┌─────────────────────┐   │
│  │ ☀️  25°C             │   │
│  │ 1/20 12:00          │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ ⛅  22°C             │   │
│  │ 1/20 15:00          │   │
│  └─────────────────────┘   │
│  ...                        │
└─────────────────────────────┘
```

### ローディング状態

```
┌─────────────────────────────┐
│  ← 戻る    東京の天気        │
├─────────────────────────────┤
│  ┌─────────────────────┐   │
│  │ ████████  ████      │   │  ← スケルトン
│  │ ████████            │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ ████████  ████      │   │
│  │ ████████            │   │
│  └─────────────────────┘   │
└─────────────────────────────┘
```

### エラー画面

```
┌─────────────────────────────┐
│                             │
│    ⚠️ エラーが発生しました    │
│                             │
│    天気情報を取得できません    │
│    でした。                  │
│                             │
│    [ ホームに戻る ]          │
│                             │
└─────────────────────────────┘
```

---

## 評価観点への対応

| 評価観点 | 対応 |
|----------|------|
| 要件を満たしているか | 全機能要件を実装 |
| 機能が正しく動作するか | テストで担保 |
| プログラム設計の品質 | 責務分離（hooks, api, components）、型安全 |
| ソースコードの品質 | TypeScript厳格モード、一貫した命名規則 |
| 挙動の品質 | スケルトン、エラーハンドリング、キャッシュ |

---

## リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| TanStack Query学習に時間がかかる | Phase 1遅延 | 公式ドキュメントのQuick Startに集中、最小限の機能から |
| React Router学習に時間がかかる | Phase 1遅延 | 今回必要なのは基本的な使い方のみ |
| APIキーの取得に時間がかかる | 開発開始遅延 | 先にセットアップを完了させ、モックデータで開発開始 |
| テストが想定より難しい | Phase 2遅延 | 最低限utils関数のテストは書き、フックテストは余裕があれば |

---

## 備考

### APIキーの管理

```bash
# .env.local（gitignore対象）
VITE_OPENWEATHER_API_KEY=your_api_key_here
```

```typescript
// 使用時
const API_KEY = import.meta.env.VITE_OPENWEATHER_API_KEY;
```

### キャッシュ設定

```typescript
// TanStack Queryの設定
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 10, // 10分間キャッシュを新鮮とみなす
      gcTime: 1000 * 60 * 30,    // 30分間キャッシュを保持
    },
  },
});
```

---

## 次のアクション

1. OpenWeatherMapでAPIキーを発行する
2. プロジェクトをセットアップする
3. 実装を開始する（詳細は [TASKS.md](./TASKS.md) を参照）
